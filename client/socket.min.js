window.Socket=function(){function k(){var a=this.server,b;try{b=a.server?new WebSocket("ws://"+a.server):new WebSocket("ws://"+a.url+":"+a.port+"/?"+(a.parameters||""),a.protocol||null)}catch(c){throw Error(c);}this.socket=b;a=this.config.autoReconnect;b=function(a){if(this.id){if(!(a.type===this.last&&"close"===a.type)){this.last=a.type;var c=d[a.type];if(c.length)for(var b=0,e=c.length;b<e;b++)c[b](a)}}else if(a=a.data)this.id=a,n.apply(this,["open",a])};for(var e=this.socket,h=["open","message",
"close","error"],d=this.handler||{},g=0,f=h.length;g<f;g++)d[h[g]]||(d[h[g]]=[]),e.addEventListener(h[g],b.bind(this));this.handler?this.info.reconnected||(this.info.reconnected=!0,d.reconnect.push(function(){this.info._start=Date.now();l.call(this)}.bind(this)),d.open=d.reconnect):(a&&d.open.push(function(){this.info._start=Date.now();d.close.push(this.reconnect.bind(this))}.bind(this)),d.reconnect=[],this.handler=d)}function n(a,b){for(var c=this.handler[a],e=c.length;e--;)c[e](b)}function l(){for(var a=
this.messageQueue,b=this.socket;a.length;)b.send(a.shift())}function p(){this.socket.readyState!==j.connecting&&this.socket.readyState!==j.open?k.call(this):(clearInterval(this.reconnectID),delete this.reconnectID)}var m={retryTimer:5E3,autoReconnect:!1,serialization:null},j={connecting:0,open:1,closing:2,closed:3},f=function(a,b){this.server="string"===typeof a?{server:a}:a;for(var c in b)m[c]=b[c];this.config=m;this.last=this.id=null;this.messageQueue=[];c={lastPing:null,latency:null,bandwidth:null,
extensions:null,reconnected:!1};Object.defineProperty(c,"duration",{get:function(){return Date.now()-this._start}});this.info=c;k.call(this)};f.prototype.on=function(a,b){var c=b;b=function(a){if(!a||!a.data)return c();var b=a.data;try{var d=JSON.parse,b=d(b)}catch(f){throw Error(f);}c(b,a)}.bind(this);this.handler[a].push(b)};f.prototype.off=function(a,b){var c=this.handler[a];if(c)if(b)for(var e=c.length;e--;){if(c[e]===b){c.splice(e,1);break}}else c.length=0};f.prototype.reconnect=function(){this.reconnectID||
(this.socket.readyState!==j.closed&&this.socket.close(),this.reconnectID=setInterval(p.bind(this),this.config.retryTimer))};f.prototype.send=function(a,b){var c=JSON.stringify;msg=c({id:this.id,action:a,data:b});this.messageQueue.push(msg);this.socket.readyState===j.open&&l.call(this)};return f}();
