window.vwc||(window.vwc={});
vwc.Socket=function(){function h(){var a=this.server,b;try{b=a.server?new WebSocket("ws://"+a.server):new WebSocket("ws://"+a.url+":"+a.port,a.protocol||null)}catch(c){console.log("[error] - "+c);return}this.socket=b;a=this.config.autoReconnect;b=function(a){if(!(a.type===this.last&&"close"===a.type)){this.last=a.type;var b=e[a.type];if(b.length)for(var c=0,d=b.length;c<d;c++)b[c](a)}};for(var l=this.socket,g=["open","message","close","error"],e=this.handler||{},d=0,f=g.length;d<f;d++)e[g[d]]||(e[g[d]]=
[]),l.addEventListener(g[d],b.bind(this));this.handler?this.info.reconnected||(this.info.reconnected=!0,e.reconnect.push(function(){this.info._start=Date.now();j.call(this)}.bind(this)),e.open=e.reconnect):(a&&e.open.push(function(){this.info._start=Date.now();e.close.push(this.reconnect.bind(this))}.bind(this)),e.reconnect=[],this.handler=e)}function j(){for(var a=this.messageQueue,b=this.socket;a.length;)b.send(a.shift())}function m(){this.socket.readyState!==f.connecting&&this.socket.readyState!==
f.open?h.call(this):(clearInterval(this.reconnectID),delete this.reconnectID)}var k={retryTimer:5E3,encode:null},f={connecting:0,open:1,closing:2,closed:3},d=function(a,b){this.server="string"===typeof a?{server:a}:a;for(var c in b)k[c]=b[c];this.config=k;this.last=this.id=null;this.messageQueue=[];c={lastPing:null,latency:null,bandwidth:null,extensions:null,reconnected:!1};Object.defineProperty(c,"duration",{get:function(){return Date.now()-this._start}});this.info=c;h.call(this)};d.prototype.on=
function(a,b){var c=b;b=function(a){var b=a.data;if(void 0!==b){try{b=(this.config.decode||JSON.parse)(b)}catch(d){}c(b,a)}else c(a)};this.handler[a].push(b)};d.prototype.off=function(a,b){var c=this.handler[a];if(c)if(b)for(var d=c.length;d--;){if(console.log(c[d]===b),c[d]===b){c.splice(d,1);break}}else c.length=0};d.prototype.reconnect=function(){this.reconnectID||(this.socket.readyState!==f.closed&&this.socket.close(),this.reconnectID=setInterval(m.bind(this),this.config.retryTimer))};d.prototype.send=
function(a){a=(this.config.encode||JSON.stringify)(a);this.messageQueue.push(a);this.socket.readyState===f.open&&j.call(this)};return d}();
